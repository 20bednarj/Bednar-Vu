---
title: "Final Project"
due date: "12/14/2021"
output: html_notebook
---

### Load Libraries & Data
```{r}
library(jsonlite)
library(lubridate)
library(gghighlight)
library(spotifyr)
library(tidyverse)
library(knitr)
library(ggplot2)
library(plotly)
library(esquisse)

# Gus history
streamHistoryGus <- fromJSON("GusStreamingHistory0.json", flatten = TRUE)
streamHistoryGus <- fromJSON("GusStreamingHistory1.json", flatten = TRUE)

# Jeremy history
streamHistoryJeremy <- fromJSON("JeremyStreamingHistory0 copy.json", flatten = TRUE)
streamHistoryJeremy <- fromJSON("JeremyStreamingHistory1 copy.json", flatten = TRUE)
streamHistoryJeremy <- fromJSON("JeremyStreamingHistory2 copy.json", flatten = TRUE)
streamHistoryJeremy <- fromJSON("JeremyStreamingHistory3 copy.json", flatten = TRUE)
streamHistoryJeremy <- fromJSON("JeremyStreamingHistory4 copy.json", flatten = TRUE)

```



### Listening Length Per User By Song
```{r}
streamHistoryJeremySong <- 
    streamHistoryJeremy %>%
    group_by(trackName, artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Jeremy")

streamHistoryGusSong <- 
    streamHistoryGus %>%
    group_by(trackName, artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Gus")

```

### Listening Length Per User By Artist
```{r}
streamHistoryJeremyArtist <- 
    streamHistoryJeremy %>%
    group_by(artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Jeremy")

streamHistoryGusArtist <- 
    streamHistoryGus %>%
    group_by(artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Gus")

```

### Gus and Jeremy Full Join
```{r}
streamHistoryGusAndJeremySong<-
  streamHistoryGusSong%>%
  full_join(streamHistoryJeremySong) %>%
  filter(trackName != "Unknown Track") %>%
  arrange(desc(msTotal))

head(streamHistoryGusAndJeremySong)

esquisser(streamHistoryGusAndJeremySong)

```

```{r}
#gus

Sys.setenv(SPOTIFY_CLIENT_ID = '949891eb08fe47cb8e6e031a841b76ba')
Sys.setenv(SPOTIFY_CLIENT_SECRET = '54b9813cd7bc40eca15514be0b52701b')

#jeremy

Sys.setenv(SPOTIFY_CLIENT_ID = '36a9ea1b654f4f8cbded39f1c2896de6')
Sys.setenv(SPOTIFY_CLIENT_SECRET = 'a6571acabf7142cc9dbfddf0ecce6ee7')



```

```{r}
library(spotifyr)
uzi <- get_artist_audio_features('Lil Uzi Vert')

library(dplyr)
library(purrr)
library(knitr)

uzi %>% 
    count(key_mode, sort = TRUE) %>% 
    head(5) %>% 
    kable()


library(lubridate)

get_my_recently_played(limit = 5) %>% 
    mutate(
        artist.name = map_chr(track.artists, function(x) x$name[1]),
        played_at = as_datetime(played_at)
        ) %>% 
    select(
      all_of(c("track.name", "artist.name", "track.album.name", "played_at"))
      ) %>% 
    kable()


get_my_top_artists_or_tracks(type = 'artists', 
                             time_range = 'long_term', 
                             limit = 5) %>% 
    select(.data$name, .data$genres) %>% 
    rowwise %>% 
    mutate(genres = paste(.data$genres, collapse = ', ')) %>% 
    ungroup %>% 
    kable()


```


```{r}

```





