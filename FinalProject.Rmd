---
title: "Final Project"
due date: "12/14/2021"
output: html_notebook
---

### Load Libraries & Data
```{r}
library(jsonlite)
library(lubridate)
library(gghighlight)
library(spotifyr)
library(tidyverse)
library(knitr)
library(ggplot2)
library(plotly)
library(esquisse)

# Gus history
streamHistoryGus0 <- fromJSON("GusStreamingHistory0.json", flatten = TRUE)
streamHistoryGus1 <- fromJSON("GusStreamingHistory1.json", flatten = TRUE)

# Jeremy history
streamHistoryJeremy0 <- fromJSON("JeremyStreamingHistory0 copy.json", flatten = TRUE)
streamHistoryJeremy1 <- fromJSON("JeremyStreamingHistory1 copy.json", flatten = TRUE)
streamHistoryJeremy2 <- fromJSON("JeremyStreamingHistory2 copy.json", flatten = TRUE)
streamHistoryJeremy3 <- fromJSON("JeremyStreamingHistory3 copy.json", flatten = TRUE)
streamHistoryJeremy4 <- fromJSON("JeremyStreamingHistory4 copy.json", flatten = TRUE)

# Joining Data Frames Per User
streamHistoryJeremy <-
  streamHistoryJeremy0 %>%
  full_join(streamHistoryJeremy1) %>%
  full_join(streamHistoryJeremy2) %>%
  full_join(streamHistoryJeremy3) %>%
  full_join(streamHistoryJeremy4)

streamHistoryGus <-
  streamHistoryGus0 %>%
  full_join(streamHistoryGus1)

#API Access (Gus)
Sys.setenv(SPOTIFY_CLIENT_ID = '949891eb08fe47cb8e6e031a841b76ba')
Sys.setenv(SPOTIFY_CLIENT_SECRET = '54b9813cd7bc40eca15514be0b52701b')

access_token <- get_spotify_access_token()
```

### streamHistory Combined
```{r}
#Adding "User" to streamHistoryOG tables

streamHistoryJeremy %>%
  mutate(Listener = 'Jeremy')

streamHistoryGus %>%
  mutate(Listener = 'Gus')
  

```

### Listening Length Per User By Song
```{r}
streamHistoryJeremySong <- 
    streamHistoryJeremy %>%
    group_by(trackName, artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Jeremy")

streamHistoryGusSong <- 
    streamHistoryGus %>%
    group_by(trackName, artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Gus")

```

### Listening Length Per User By Artist
```{r}
streamHistoryJeremyArtist <- 
    streamHistoryJeremy %>%
    group_by(artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Jeremy")

streamHistoryGusArtist <- 
    streamHistoryGus %>%
    group_by(artistName) %>%
    select(artistName, trackName, msPlayed) %>%
    summarize(msTotal = sum(msPlayed)) %>%
    mutate(Listener = "Gus")

```

### Gus and Jeremy Full Join (streamHistory, Song, and Artist)
```{r}
streamHistoryGusAndJeremyOG <-
  streamHistoryGus %>%
  full_join(streamHistoryJeremy) 

streamHistoryGusAndJeremySong<-
  streamHistoryGusSong %>%
  full_join(streamHistoryJeremySong) %>%
  filter(trackName != "Unknown Track") %>%
  arrange(desc(msTotal))

streamHistoryGusAndJeremyArtist <-
  streamHistoryGusArtist %>%
  full_join(streamHistoryJeremyArtist) %>%
  arrange(desc(msTotal))

streamHistoryGusAndJeremySong %>%
  head(10)



```

### Esquisse for Songs & Artists
```{r}

#Top 10 songs Gus
GusTopTenSong <-
  streamHistoryGusSong %>%
  arrange(desc(msTotal)) %>%
  head(10)
ggplot(GusTopTenSong) +
  aes(x = reorder(trackName,+msTotal), fill = artistName, weight = msTotal) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  labs(title = "Gus Top 10 Songs") +
  coord_flip() +
  theme_bw() +
  xlab("Track Name") +
  ylab("Total Ms Listened")

#Top 10 Songs Jeremy
JeremyTopTenSong <-
  streamHistoryJeremySong %>%
  arrange(desc(msTotal)) %>%
  head(10)
ggplot(Jeremytoptensong) +
  aes(x = reorder(trackName,+msTotal), fill = artistName, weight = msTotal) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  labs(title = "Jeremy Top 10 Songs") +
  coord_flip() +
  theme_bw() +
  xlab("Track Name") +
  ylab("Total Ms Listened")
```

### Top 10 Artists
```{r}
GusTopTenArtist <-
  streamHistoryGusArtist %>%
  arrange(desc(msTotal)) %>%
  head(10)
ggplot(GusTopTenArtist) +
  aes(x = reorder(artistName,+msTotal), fill = artistName, weight = msTotal) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  labs(title = "Top 10 Artists For Gus") +
  coord_flip() +
  theme_bw() +
  xlab("Artist") +
  ylab("Total Ms Listened")

JeremyTopTenArtist <-
  streamHistoryJeremyArtist %>%
  arrange(desc(msTotal)) %>%
  head(10)
ggplot(JeremyTopTenArtist) +
  aes(x = reorder(artistName,+msTotal), fill = artistName, weight = msTotal) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  labs(title = "Top 10 Artists For Jeremy") +
  coord_flip() +
  theme_bw() +
  xlab("Artist") +
  ylab("Total Ms Listened")

```


### Initial CoPlaylist
```{r}
CoPlaylist <-
  streamHistoryJeremySong %>%
  filter(msTotal <= 600000) %>%
  inner_join(streamHistoryGusSong, by = c("trackName" = "trackName","artistName" = "artistName")) 
  
```


